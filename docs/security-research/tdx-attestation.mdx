---
title: "TDX Attestation Security"
description: "Deep dive into dstack's Intel TDX attestation implementation and security guarantees"
---




Based on my comprehensive analysis of the dstack TDX attestation library, here is the complete updated MDX security analysis:

# TDX Attestation Security Analysis

## Overview

The dstack TDX attestation system provides hardware-rooted cryptographic proof of execution integrity through Intel Trust Domain Extensions (TDX). The implementation centers around the `tdx-attest` crate which interfaces directly with Intel TDX hardware to generate unforgeable attestation quotes [1](#0-0) .

## Security Architecture

### Hardware Root of Trust

The attestation system leverages Intel TDX CPU instructions to generate TD reports that cannot be forged by software, including malicious hypervisors. The core implementation uses direct CPU calls through the `tdx_att_get_report` and `tdx_att_get_quote` functions [2](#0-1) [3](#0-2) .

### Cryptographic Foundations

The system employs ECDSA signatures with Intel-provisioned attestation keys, ensuring that only legitimate TDX hardware can generate valid quotes. The attestation data structure includes a 1024-byte TDX report containing measurements and a 64-byte report data field for binding application-specific data [4](#0-3) .

### Runtime Measurement Registers (RTMR)

The security model relies on four Runtime Measurement Registers that track different aspects of the system:
- RTMR0: Virtual hardware configuration including CPU count and memory size
- RTMR1: Linux kernel measurement  
- RTMR2: Kernel command line and initramfs measurements
- RTMR3: Application-specific runtime measurements including compose hash and instance ID

The RTMR extension mechanism uses SHA-384 hashing to maintain a tamper-evident log [5](#0-4) [6](#0-5) .

### Event Log Security

The attestation system maintains a cryptographically verifiable event log that records all RTMR extensions. Each event includes the measurement register index, event type, description, and payload data [7](#0-6) . The event log replay mechanism ensures that claimed RTMR values match the actual sequence of measurements [8](#0-7) .

## Quote Generation and Verification

### Quote Structure and Content

The TDX quote contains the TD report, attestation key identifier, and ECDSA signature. The guest agent implements secure quote generation by padding user data to exactly 64 bytes and interfacing with the hardware attestation service [9](#0-8) .

### Report Data Binding

Applications can bind arbitrary data to quotes through the report data field using multiple cryptographic hash algorithms including SHA-256, SHA-384, SHA-512, and Keccak variants. The system supports both hashed content and raw data binding with proper length validation [10](#0-9) .

### Certificate Integration

The RA-TLS implementation embeds TDX quotes directly into X.509 certificates, enabling transparent attestation during TLS handshakes. This approach allows verifiers to validate both the certificate chain and the underlying TEE attestation simultaneously [11](#0-10) .

## Verification Security Model

### Quote Verification Process

The verification process validates the ECDSA signature against Intel's certificate chain, checks the TCB (Trusted Computing Base) status for known vulnerabilities, and replays the event log to verify RTMR consistency [12](#0-11) .

### TCB Validation

The system enforces strict TCB policies by rejecting debug-enabled TDs and validating that security-critical measurement registers contain expected values. This prevents attestation of compromised or development environments in production [13](#0-12) .

### Measurement Chain Validation

The verification process reconstructs the complete measurement chain from the initial MRTD (Measurement Root of Trust for Data) through all RTMR values, ensuring that every component in the trusted execution path can be verified [14](#0-13) .

## Integration Security

### Guest Agent Security

The guest agent provides attestation services through authenticated RPC interfaces, implementing secure key derivation and certificate signing capabilities. The agent validates all quote requests and maintains isolation between different application contexts [15](#0-14) .

### KMS Integration

The Key Management Service relies on TDX attestation for secure key provisioning, implementing a chain-of-trust model where application keys are derived from hardware-attested root keys. The KMS validates TDX quotes before releasing any cryptographic material [16](#0-15) .

## Threat Model and Security Guarantees

### Protected Against

The attestation system provides protection against malicious hypervisors, runtime attacks detected through RTMR changes, and rollback attacks prevented by TCB version checks. The nonce-based binding mechanism mitigates man-in-the-middle attacks during attestation exchanges [17](#0-16) .

### Verification Requirements

Complete security verification requires validating the source code, building images from source, calculating expected measurement values, and verifying that quote measurements match pre-calculated values. The event log must be replayed to confirm RTMR3 consistency [18](#0-17) .

### Trust Boundaries

The system establishes clear trust boundaries where Intel TDX hardware serves as the ultimate root of trust, with measurements extending through the virtual firmware (OVMF), Linux kernel, initramfs, and application components. Each boundary is cryptographically verified through the measurement chain [19](#0-18) .

## Cryptographic Implementation Details

### Hash Algorithm Support

The attestation system supports multiple cryptographic hash algorithms with proper algorithm identification and content type prefixing. This flexibility allows applications to choose appropriate hash functions while maintaining security through standardized content formatting [20](#0-19) .

### Key Derivation Security

Application keys are derived using hardware-sealed root keys with application-specific identifiers, ensuring cryptographic isolation between different applications and use cases. The derivation process includes digital signatures that can be verified independently [21](#0-20) .

## Error Handling and Security

The implementation includes comprehensive error handling for all attestation operations, with specific error codes for different failure modes including hardware failures, invalid parameters, and attestation service unavailability [22](#0-21) .

## Simulator Mode Security

For development purposes, the system includes a simulator mode that maintains the same API surface while using pre-generated quotes and event logs. This mode is clearly identified and disabled in production environments to prevent security bypass [23](#0-22) .

## Security Monitoring and Auditability

The event logging system provides complete auditability of all runtime measurements, with cryptographic binding between events and their corresponding RTMR extensions. This enables post-hoc verification of the complete execution history [7](#0-6) .

## Notes

The dstack TDX attestation implementation provides enterprise-grade security through hardware-rooted trust, comprehensive measurement chains, and rigorous verification procedures. The system's security relies on Intel TDX hardware guarantees combined with careful cryptographic implementation and thorough validation of all trust boundaries. The modular design allows for flexible deployment while maintaining strong security properties across different use cases and environments.


## References

- [Intel TDX Module 1.5 Specification](https://www.intel.com/content/www/us/en/developer/articles/technical/intel-trust-domain-extensions.html)
- [TDX Attestation Architecture](https://download.01.org/intel-sgx/latest/dcap-latest/linux/docs/TDX_Attestation_Architecture.pdf)
- [dstack Attestation Design Doc](https://github.com/Dstack-TEE/dstack/blob/master/attestation.md)

<div className="mt-8 p-4 bg-blue-50 rounded-lg border border-blue-200">
  <p className="text-sm text-blue-800">
    <strong>Next Component:</strong> Learn how attestation integrates with the <a href="/docs/security-research/vmm-security" className="underline">VMM security architecture</a>.
  </p>
</div> 