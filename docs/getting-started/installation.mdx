---
title: "Installation"
description: "Set up dstack on your server with our comprehensive installation guide"
---

# Installation Guide

This guide walks you through installing dstack on your server. The installation process typically takes 30-60 minutes depending on your hardware and network speed.

<div className="bg-blue-50 border-l-4 border-blue-400 p-4 mb-6">
  <div className="flex">
    <div className="ml-3">
      <p className="text-sm text-blue-700">
        <strong>Quick Alternative:</strong> If you don't have TEE hardware, you can use <a href="https://cloud.phala.network/register?invite=beta" className="underline">Phala Cloud</a> to test dstack without local installation.
      </p>
    </div>
  </div>
</div>

## Prerequisites

### Hardware Requirements

dstack requires TEE-capable hardware. Currently supported:

| Component | Minimum | Recommended |
|-----------|---------|-------------|
| **CPU** | Intel with TDX support | Intel Xeon 4th Gen (Sapphire Rapids) or newer |
| **RAM** | 16 GB | 32 GB or more |
| **Storage** | 100 GB SSD | 500 GB NVMe SSD |
| **Network** | 1 Gbps | 10 Gbps |

<details>
<summary>How to check if your CPU supports Intel TDX</summary>

Run this command to check for TDX support:

```bash
grep -E 'tdx|TDX' /proc/cpuinfo
```

If you see output, your CPU likely supports TDX. For detailed verification:

```bash
sudo dmesg | grep -i tdx
```

</details>

### Software Requirements

- **Operating System**: Ubuntu 24.04 LTS (recommended) or Ubuntu 22.04 LTS
- **Kernel**: 5.15 or newer with TDX support
- **Docker**: Not required (dstack manages containers internally)

### Network Requirements

Ensure the following ports are available:

| Port | Service | Direction | Purpose |
|------|---------|-----------|---------|
| 9080 | Web UI | Inbound | dstack management interface |
| 9090 | API | Inbound | Application API access |
| 443 | HTTPS | Inbound | Secure application access |
| 80 | HTTP | Inbound | HTTP to HTTPS redirect |
| 51820 | WireGuard | In/Out | Secure VPN tunnels |

## Step 1: Install System Dependencies

First, update your system and install required packages:

```bash
# Update package lists
sudo apt update && sudo apt upgrade -y

# Install build dependencies
sudo apt-get install -y \
    build-essential \
    chrpath \
    diffstat \
    lz4 \
    wireguard-tools \
    xorriso \
    git \
    curl \
    wget

# Install additional tools
sudo apt-get install -y \
    jq \
    htop \
    net-tools \
    ca-certificates
```

### Install Rust

dstack is built with Rust. Install it using rustup:

```bash
# Download and install rustup
curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh

# Follow the prompts and select default installation

# Source cargo environment
source $HOME/.cargo/env

# Verify installation
rustc --version
```

Expected output:
```
rustc 1.75.0 (or newer)
```

## Step 2: Clone and Build dstack

### Clone the Repository

```bash
# Create workspace directory
mkdir -p ~/dstack-workspace
cd ~/dstack-workspace

# Clone with submodules
git clone https://github.com/Dstack-TEE/meta-dstack.git --recursive
cd meta-dstack
```

### Configure Build Settings

```bash
# Generate default configuration
./build.sh hostcfg

# This creates build-config.sh
```

<details>
<summary>Advanced: Customize build configuration</summary>

Edit `build-config.sh` to customize settings:

```bash
# Network configuration
KVM_TAP_NETWORK="10.8.8.0/24"
GATEWAY_WG_NETWORK="10.9.0.0/16"

# Resource allocation
CID_START=33000
CID_POOL_SIZE=1000

# Performance tuning
MAX_VMS=50
DEFAULT_VM_MEMORY=4096
```

After editing, regenerate configuration:
```bash
./build.sh hostcfg
```

</details>

### Build dstack Components

```bash
# Build all components
./build.sh build

# This compiles:
# - dstack-vmm (Virtual Machine Manager)
# - dstack-gateway (HTTPS Gateway)
# - dstack-kms (Key Management Service)
# - Supporting tools
```

Build time: ~10-15 minutes on modern hardware

## Step 3: Download or Build Guest OS Image

dstack applications run inside a secure guest OS. You can either download a pre-built image or build your own.

### Option A: Download Pre-built Image (Recommended)

```bash
# Download latest stable version
./build.sh dl 0.5.1

# Verify download
ls -lah dstack-guest-*.img
```

### Option B: Build Guest Image

<details>
<summary>Build from source (advanced)</summary>

```bash
# Ensure AppArmor allows unprivileged namespaces
sudo sysctl kernel.apparmor_restrict_unprivileged_userns=0

# Build guest image
./build.sh guest

# This builds a minimal Linux image with:
# - dstack-os (secure OS)
# - dstack-guest-agent
# - Container runtime
```

Build time: ~30-45 minutes

</details>

## Step 4: Configure dstack Components

### Create Configuration Files

```bash
# Create config directory
mkdir -p ~/.dstack/config
cd ~/.dstack/config
```

#### KMS Configuration (kms.toml)

```toml
[general]
name = "dstack-kms-01"
log_level = "info"

[rpc]
listen = "127.0.0.1:8000"
ra_tls_cert = "/etc/dstack/certs/kms.crt"
ra_tls_key = "/etc/dstack/certs/kms.key"

[core]
blockchain_rpc = "https://ethereum-rpc.example.com"
contract_address = "0x..."  # Will be set during deployment

[authorization]
api_endpoint = "http://localhost:9080/api"
```

#### Gateway Configuration (gateway.toml)

```toml
[general]
name = "dstack-gateway-01"
log_level = "info"

[network]
public_ip = "YOUR_PUBLIC_IP"
wg_endpoint = "YOUR_PUBLIC_IP:51820"
srv_domain = "app.yourdomain.com"

[gateway]
app_id = "auto-generated-on-first-run"
listen = "0.0.0.0:443"
http_listen = "0.0.0.0:80"

[certificate]
email = "admin@yourdomain.com"
use_staging = false  # Set to true for testing
```

#### VMM Configuration (vmm.toml)

```toml
[general]
name = "dstack-vmm-01"
log_level = "info"

[resources]
cid_start = 33000
cid_pool_size = 1000
max_vms = 50

[network]
mode = "user"  # or "tap" for advanced networking
interface = "eth0"

[api]
listen = "127.0.0.1:9080"
public_url = "http://localhost:9080"
```

## Step 5: Initialize TLS Certificates

Generate initial certificates for secure communication:

```bash
# Create certificate directory
sudo mkdir -p /etc/dstack/certs
cd /etc/dstack/certs

# Generate self-signed certificate for initial setup
sudo openssl req -x509 -newkey rsa:4096 \
    -keyout kms.key -out kms.crt \
    -days 365 -nodes \
    -subj "/CN=dstack-kms/O=dstack"

# Set permissions
sudo chmod 600 kms.key
sudo chmod 644 kms.crt
```

## Step 6: Start dstack Services

Start each component in a separate terminal or use systemd services:

### Terminal Method

```bash
# Terminal 1: Start KMS
cd ~/dstack-workspace/meta-dstack
./dstack-kms -c ~/.dstack/config/kms.toml

# Terminal 2: Start Gateway (requires sudo)
cd ~/dstack-workspace/meta-dstack
sudo ./dstack-gateway -c ~/.dstack/config/gateway.toml

# Terminal 3: Start VMM
cd ~/dstack-workspace/meta-dstack
./dstack-vmm -c ~/.dstack/config/vmm.toml
```

### Systemd Services (Recommended)

<details>
<summary>Set up systemd services</summary>

Create service files:

```bash
# dstack-kms.service
sudo tee /etc/systemd/system/dstack-kms.service > /dev/null <<EOF
[Unit]
Description=dstack Key Management Service
After=network.target

[Service]
Type=simple
User=$USER
WorkingDirectory=$HOME/dstack-workspace/meta-dstack
ExecStart=$HOME/dstack-workspace/meta-dstack/dstack-kms -c $HOME/.dstack/config/kms.toml
Restart=on-failure
RestartSec=10

[Install]
WantedBy=multi-user.target
EOF

# dstack-gateway.service
sudo tee /etc/systemd/system/dstack-gateway.service > /dev/null <<EOF
[Unit]
Description=dstack Gateway Service
After=network.target dstack-kms.service

[Service]
Type=simple
User=root
WorkingDirectory=$HOME/dstack-workspace/meta-dstack
ExecStart=$HOME/dstack-workspace/meta-dstack/dstack-gateway -c $HOME/.dstack/config/gateway.toml
Restart=on-failure
RestartSec=10

[Install]
WantedBy=multi-user.target
EOF

# dstack-vmm.service
sudo tee /etc/systemd/system/dstack-vmm.service > /dev/null <<EOF
[Unit]
Description=dstack Virtual Machine Manager
After=network.target dstack-kms.service

[Service]
Type=simple
User=$USER
WorkingDirectory=$HOME/dstack-workspace/meta-dstack
ExecStart=$HOME/dstack-workspace/meta-dstack/dstack-vmm -c $HOME/.dstack/config/vmm.toml
Restart=on-failure
RestartSec=10

[Install]
WantedBy=multi-user.target
EOF

# Enable and start services
sudo systemctl daemon-reload
sudo systemctl enable dstack-kms dstack-gateway dstack-vmm
sudo systemctl start dstack-kms dstack-gateway dstack-vmm
```

</details>

## Step 7: Verify Installation

### Check Service Status

```bash
# If using systemd
sudo systemctl status dstack-kms dstack-gateway dstack-vmm

# Check logs
sudo journalctl -u dstack-vmm -f
```

### Access Web UI

Open your browser and navigate to:
- **Local**: http://localhost:9080
- **Remote**: http://YOUR_SERVER_IP:9080

You should see the dstack management interface.

### Test API Endpoints

```bash
# Check VMM health
curl http://localhost:9080/api/health

# Expected response
{"status":"healthy","version":"0.5.1"}
```

## Troubleshooting

### Common Issues

<details>
<summary>Services fail to start</summary>

1. Check logs for specific errors:
   ```bash
   sudo journalctl -u dstack-vmm -n 50
   ```

2. Verify ports are not in use:
   ```bash
   sudo netstat -tulpn | grep -E '9080|9090|443|80'
   ```

3. Ensure configuration files are valid:
   ```bash
   cat ~/.dstack/config/*.toml | grep -E "^\[|="
   ```

</details>

<details>
<summary>Build failures</summary>

1. Ensure all dependencies are installed:
   ```bash
   ./build.sh check-deps
   ```

2. Clear build cache and retry:
   ```bash
   ./build.sh clean
   ./build.sh build
   ```

3. Check Rust version:
   ```bash
   rustc --version  # Should be 1.75.0 or newer
   ```

</details>

<details>
<summary>Network connectivity issues</summary>

1. Check firewall rules:
   ```bash
   sudo ufw status
   ```

2. Verify WireGuard is installed:
   ```bash
   wg version
   ```

3. Test connectivity:
   ```bash
   nc -zv localhost 9080
   ```

</details>

## Next Steps

Congratulations! You've successfully installed dstack. Now you can:

<div className="grid grid-cols-1 md:grid-cols-3 gap-4 mt-6">
  <Card title="Deploy Your First App" icon="rocket" href="/getting-started/first-deployment">
    Deploy a containerized application to a TEE
  </Card>
  {/* Component configuration coming soon:
  <Card title="Configure Components" icon="cog" href="/deployment-guides/configuring-components">
    Fine-tune dstack for your needs
  </Card>
  */}
  <Card title="Explore Examples" icon="code" href="/tutorials/python-example">
    Check out sample applications
  </Card>
</div>

## Additional Resources

- [System Architecture](/concepts/architecture) - Understand how dstack components work together
- [Security Model](/concepts/security-model) - Learn about TEE security features
- [Troubleshooting Guide](/troubleshooting) - Detailed solutions for common issues
- [Community Support](https://github.com/Dstack-TEE/dstack/discussions) - Get help from the community
- [First Deployment Guide](/getting-started/first-deployment) - Deploy your first application 